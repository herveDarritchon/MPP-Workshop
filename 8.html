<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>[AddressBook] Building the common library</title>
<link rel="stylesheet" href="./golo.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>[AddressBook] Building the common library</h1>
<div class="details">
<span id="revnumber">version 1.0</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_project_creation">Project creation</a></li>
<li><a href="#_gradle_configuration">Gradle configuration</a>
<ul class="sectlevel2">
<li><a href="#_plugins">Plugins</a></li>
<li><a href="#_targets">Targets</a></li>
<li><a href="#_source_sets_and_dependencies">Source sets and dependencies</a></li>
</ul>
</li>
<li><a href="#_defining_the_domain_objects">Defining the domain objects</a></li>
<li><a href="#_reaching_the_backend_api">Reaching the backend API</a></li>
<li><a href="#_implementing_the_mvp_pattern">Implementing the MVP pattern</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_project_creation"><a class="anchor" href="#_project_creation"></a>Project creation</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_gradle_configuration"><a class="anchor" href="#_gradle_configuration"></a>Gradle configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_plugins"><a class="anchor" href="#_plugins"></a>Plugins</h3>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">plugins {
    id("org.jetbrains.kotlin.multiplatform")
    id("org.jetbrains.kotlin.plugin.serialization")
    `maven-publish`
}

repositories {
    jcenter()
    google()
    maven(url = "https://kotlin.bintray.com/kotlinx")
    maven(url = "https://dl.bintray.com/jetbrains/kotlin-native-dependencies")
}

group = "com.mybusiness"
version = "1.0-SNAPSHOT"</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_plugin_management"><a class="anchor" href="#_plugin_management"></a>Plugin management</h4>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">val kotlinVersion = "1.3.50"

pluginManagement {
    resolutionStrategy {
        eachPlugin {
            when (requested.id.id) {
                "org.jetbrains.kotlin.multiplatform" -&gt; useModule("org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlinVersion")
                "org.jetbrains.kotlin.plugin.serialization" -&gt; useModule("org.jetbrains.kotlin:kotlin-serialization:$kotlinVersion")
            }
        }
    }

    repositories {
        jcenter()
        google()
    }
}

enableFeaturePreview("GRADLE_METADATA")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_targets"><a class="anchor" href="#_targets"></a>Targets</h3>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
    jvm("android") {
        tasks.withType&lt;org.jetbrains.kotlin.gradle.tasks.KotlinCompile&gt; {
            kotlinOptions {
                jvmTarget = "1.8"
            }
        }
    }

    js { browser() }

    //select iOS target platform depending on the Xcode environment variables
    val iOSTarget: (String, org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget.() -&gt; Unit) -&gt; org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget =
        if (System.getenv("SDK_NAME")?.startsWith("iphoneos") == true)
            ::iosArm64
        else
            ::iosX64

    iOSTarget("ios") {
        binaries {
            framework {
                baseName = "AddressBookCommon"
            }
        }
    }

    sourceSets {
        // Versions
        val coroutinesVersion = "1.3.1"
        val ktorVersion = "1.2.4"
        val serializationVersion = "0.13.0"
        val mockkVersion = "1.9.3"

        // Shortcuts
        fun kotlinx(module: String, version: String) = "org.jetbrains.kotlinx:kotlinx-$module:$version"
        fun coroutines(module: String = "") = kotlinx("coroutines-core$module", coroutinesVersion)
        fun serialization(module: String = "") = kotlinx("serialization-runtime$module", serializationVersion)
        fun ktorClient(module: String, version: String = ktorVersion) = "io.ktor:ktor-client-$module:$version"

        val commonMain by getting {
            dependencies {
                implementation("org.jetbrains.kotlin:kotlin-stdlib-common")
                implementation(coroutines("-common"))
                implementation(serialization("-common"))

                implementation(ktorClient("core"))
                implementation(ktorClient("json"))
                implementation(ktorClient("serialization"))
            }
        }
        val commonTest by getting {
            dependencies {
                implementation(kotlin("test-common"))
                implementation(kotlin("test-annotations-common"))
                implementation("io.mockk:mockk:$mockkVersion")
            }
        }

        val androidMain by getting {
            dependencies {
                implementation("org.jetbrains.kotlin:kotlin-stdlib")
                implementation(coroutines())
                implementation(serialization())

                implementation(ktorClient("core-jvm"))
                implementation(ktorClient("json-jvm"))
                implementation(ktorClient("serialization-jvm"))
                implementation(ktorClient("apache"))
            }
        }

        val androidTest by getting {
            dependencies {
                implementation(kotlin("test"))
                implementation(kotlin("test-junit"))
                implementation("io.mockk:mockk:$mockkVersion")
            }
        }

        val iosMain by getting {
            dependencies {
                implementation(coroutines("-native"))
                implementation(serialization("-native"))

                implementation(ktorClient("core-native"))
                implementation(ktorClient("ios"))
                implementation(ktorClient("json-native"))
                implementation(ktorClient("serialization-native"))
            }
        }

        val jsMain by getting {
            dependencies {
                implementation(coroutines("-js"))
                implementation(serialization("-js"))

                implementation(ktorClient("core-js"))
                implementation(ktorClient("js"))
                implementation(ktorClient("json-js"))
                implementation(ktorClient("serialization-js"))
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_sets_and_dependencies"><a class="anchor" href="#_source_sets_and_dependencies"></a>Source sets and dependencies</h3>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
    sourceSets {
        // Versions
        val coroutinesVersion = "1.3.1"
        val ktorVersion = "1.2.4"
        val serializationVersion = "0.13.0"
        val mockkVersion = "1.9.3"

        // Shortcuts
        fun kotlinx(module: String, version: String) = "org.jetbrains.kotlinx:kotlinx-$module:$version"
        fun coroutines(module: String = "") = kotlinx("coroutines-core$module", coroutinesVersion)
        fun serialization(module: String = "") = kotlinx("serialization-runtime$module", serializationVersion)
        fun ktorClient(module: String, version: String = ktorVersion) = "io.ktor:ktor-client-$module:$version"

        val commonMain by getting {
            dependencies {
                implementation("org.jetbrains.kotlin:kotlin-stdlib-common")
                implementation(coroutines("-common"))
                implementation(serialization("-common"))

                implementation(ktorClient("core"))
                implementation(ktorClient("json"))
                implementation(ktorClient("serialization"))
            }
        }
        val commonTest by getting {
            dependencies {
                implementation(kotlin("test-common"))
                implementation(kotlin("test-annotations-common"))
                implementation("io.mockk:mockk:$mockkVersion")
            }
        }

        val androidMain by getting {
            dependencies {
                implementation("org.jetbrains.kotlin:kotlin-stdlib")
                implementation(coroutines())
                implementation(serialization())

                implementation(ktorClient("core-jvm"))
                implementation(ktorClient("json-jvm"))
                implementation(ktorClient("serialization-jvm"))
                implementation(ktorClient("apache"))
            }
        }

        val androidTest by getting {
            dependencies {
                implementation(kotlin("test"))
                implementation(kotlin("test-junit"))
                implementation("io.mockk:mockk:$mockkVersion")
            }
        }

        val iosMain by getting {
            dependencies {
                implementation(coroutines("-native"))
                implementation(serialization("-native"))

                implementation(ktorClient("core-native"))
                implementation(ktorClient("ios"))
                implementation(ktorClient("json-native"))
                implementation(ktorClient("serialization-native"))
            }
        }

        val jsMain by getting {
            dependencies {
                implementation(coroutines("-js"))
                implementation(serialization("-js"))

                implementation(ktorClient("core-js"))
                implementation(ktorClient("js"))
                implementation(ktorClient("json-js"))
                implementation(ktorClient("serialization-js"))
            }
        }
        val jsTest by getting {
            dependencies {
                implementation(kotlin("test-js"))
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_common"><a class="anchor" href="#_common"></a>Common</h4>

</div>
<div class="sect3">
<h4 id="_android"><a class="anchor" href="#_android"></a>Android</h4>

</div>
<div class="sect3">
<h4 id="_ios"><a class="anchor" href="#_ios"></a>iOS</h4>

</div>
<div class="sect3">
<h4 id="_javascript"><a class="anchor" href="#_javascript"></a>JavaScript</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_defining_the_domain_objects"><a class="anchor" href="#_defining_the_domain_objects"></a>Defining the domain objects</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_reaching_the_backend_api"><a class="anchor" href="#_reaching_the_backend_api"></a>Reaching the backend API</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_implementing_the_mvp_pattern"><a class="anchor" href="#_implementing_the_mvp_pattern"></a>Implementing the MVP pattern</h2>
<div class="sectionbody">

</div>
</div>
</div>
<link rel="stylesheet" href="highlightjs/styles/idea.min.css">
<script src="highlightjs/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>