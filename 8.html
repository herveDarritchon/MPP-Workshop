<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Address book - Building the common library</title>
<link rel="stylesheet" href="./golo.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Address book - Building the common library</h1>
<div class="details">
<span id="revnumber">version 1.0</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_project_creation">Project creation</a></li>
<li><a href="#_gradle_configuration">Gradle configuration</a>
<ul class="sectlevel2">
<li><a href="#_plugins_configuration">Plugins configuration</a></li>
<li><a href="#_targets_configuration">Targets configuration</a></li>
<li><a href="#_source_sets_and_dependencies">Source sets and dependencies</a></li>
</ul>
</li>
<li><a href="#_defining_the_domain_objects">Defining the domain objects</a></li>
<li><a href="#_reaching_the_backend_api">Reaching the backend API</a>
<ul class="sectlevel2">
<li><a href="#_creating_the_http_client">Creating the HTTP client</a></li>
<li><a href="#_creating_the_apis_interfaces">Creating the APIs interfaces</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As in the first part of this workshop, we will start by building our common library.
This one will be more complete, as we would like it to handle as much logic as possible.</p>
</div>
<div class="paragraph">
<p>Thus, after creating the project, we will put in it the following parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Gradle configuration for every targets (<em>JVM</em> for <strong><em>Android</em></strong>, <em>Native</em> for <strong><em>iOS</em></strong> and <strong><em>JavaScript</em></strong>).</p>
</li>
<li>
<p>The business domain objects</p>
</li>
<li>
<p>The backend API interfaces</p>
</li>
<li>
<p>The MVP pattern, to handle API calls and view updates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of those steps will be defined in the common code, and shared between every targeted platforms!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_creation"><a class="anchor" href="#_project_creation"></a>Project creation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Open IntelliJ IDEA and create a new project:</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 65%;">
<col style="width: 35%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/8-1.png" alt="create project"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><strong>Create a new Gradle project</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/8-2.png" alt="project details"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><strong>Fulfill your project&#8217;s details:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: <code>addressbook-common</code></p>
</li>
<li>
<p>Group ID: <code>com.mybusiness</code></p>
</li>
<li>
<p>Artifact ID: <code>addressbook-common</code></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/8-3.png" alt="project ready"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p><strong>Your project is ready!</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid any misconfiguration issue you should change the Gradle Wrapper&#8217;s properties right now.</p>
</div>
<div class="paragraph">
<p>Go the the newly created file <code>gradle-wrapper.properties</code> under <code>/addressbook-common/gradle/wrapper/</code>
and change the property <code>distributionUrl</code> with the value <code>https\://services.gradle.org/distributions/gradle-5.6.1-bin.zip</code></p>
</div>
<div class="listingblock">
<div class="title">gradle-wrapper.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-5.6.1-bin.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Gradle wrapper should upgrade itself within the next Gradle action.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_configuration"><a class="anchor" href="#_gradle_configuration"></a>Gradle configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now, we will take some time to explain the gradle configuration, as it is the heavy part of Kotlin multi-platform projects.</p>
</div>
<div class="sect2">
<h3 id="_plugins_configuration"><a class="anchor" href="#_plugins_configuration"></a>Plugins configuration</h3>
<div class="paragraph">
<p>As we saw earlier, we will need multiple Gradle plugins to achieve our Kotlin multi-platform project.</p>
</div>
<div class="paragraph">
<p>We already saw that in order to create a Kotlin multi-platform project we have to use the plugin <code>org.jetbrains.kotlin.multiplatform</code>.</p>
</div>
<div class="paragraph">
<p>Plus, our multi-platform application will need to call a backend API, thus should be able to serialize and de-serialize data.
So, we also have to use <strong>Kotlinx.Serialization</strong> with the <code>serialization</code> plugin.</p>
</div>
<div class="paragraph">
<p>Finally, as in the previous exercise, we will need the <code>maven-publish</code> plugin to be able to publish locally our library.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that we won&#8217;t cover how to deploy binaries for <strong>Native</strong> or <strong><em>JavaScript</em></strong> targets.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_enabling_the_gradle_metadata_feature"><a class="anchor" href="#_enabling_the_gradle_metadata_feature"></a>Enabling the <code>GRADLE_METADATA</code> feature</h4>
<div class="paragraph">
<p>Before configuring our plugins, we will add some configuration to be able to depends on <code>Kotlin/Native</code> libraries.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If, in your directory hierarchy, you have a file named <code>settings.gradle</code>, it should be renamed as <code>settings.gradle.kts`</code></p>
</div>
<div class="paragraph">
<p>To do so, either <strong>right-click</strong> on the file, then click on <strong>Refactor</strong> &gt; <strong>Rename&#8230;&#8203;</strong>, or use the keyboard shortcut <strong>Shift+F6</strong>.</p>
</div>
<div class="paragraph">
<p>Inside the file <code>settings.gradle.kts</code>, replace:</p>
</div>
<div class="paragraph">
<p><code>rootProject.name = 'addressbook-common'</code> by <code>rootProject.name = "addressbook-common"</code></p>
</div>
<div class="paragraph">
<p>Simple quote are from <em>Groovy</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Go to the <code>settings.gradle.kts</code> file and add the following lines:</p>
</div>
<div class="listingblock">
<div class="title">settings.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">enableFeaturePreview("GRADLE_METADATA")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, go to the <code>build.gradle.kts</code> file and replace the <code>plugins</code> and <code>repositories</code> sections by the following lines:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">plugins {
    kotlin("multiplatform") version "1.3.50" <i class="conum" data-value="1"></i><b>(1)</b>
    kotlin("plugin.serialization") version "1.3.50" <i class="conum" data-value="2"></i><b>(2)</b>
    `maven-publish`
}

group = "com.mybusiness"
version = "1.0.0-SNAPSHOT"

repositories {
    jcenter()
    maven(url = "https://kotlin.bintray.com/kotlinx") <i class="conum" data-value="3"></i><b>(3)</b>
    maven(url = "https://dl.bintray.com/jetbrains/kotlin-native-dependencies") <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using the <strong>Kotlin/Multiplatform</strong> plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using the <strong>Kotlinx.Serialization</strong> plugin</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Needed to resolve Kotlinx dependencies (e.g. Coroutines &amp; Serialization)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Needed to resolve Native dependencies</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_targets_configuration"><a class="anchor" href="#_targets_configuration"></a>Targets configuration</h3>
<div class="paragraph">
<p>As before, we will target the three environments that are the <strong><em>JVM</em></strong>, <strong><em>iOS</em></strong> and the <strong><em>Web</em></strong>.</p>
</div>
<div class="paragraph">
<p>Open the <code>build.gradle.kts</code> file and add the following code into the <code>kotlin</code> block:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
    jvm("android") { <i class="conum" data-value="1"></i><b>(1)</b>
        val main by compilations.getting {
            kotlinOptions {
                jvmTarget = "1.8"
            }
        }
    }

    iosX64("ios") { <i class="conum" data-value="2"></i><b>(2)</b>
        binaries {
            framework { <i class="conum" data-value="3"></i><b>(3)</b>
                baseName = "AddressBookCommon" <i class="conum" data-value="4"></i><b>(4)</b>
            }
        }
    }

    js { browser() } <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sets the <strong><em>JVM</em></strong> target, named <strong>android</strong> as we will build an <strong><em>Android</em></strong> afterwards.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the <strong><em>iOS</em></strong> target, named <strong>ios</strong> to simplify usage of the target</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines that the output binaries for <strong><em>iOS</em></strong>, must be a <strong><em>framework</em></strong> file&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>&#8230;&#8203;with the name <code>AddressBookCommon</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Sets the <strong><em>JavaScript</em></strong> target, packaged for a browser usage.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong><em>Android</em></strong> is running on a JVM, so it&#8217;s just a JVM target. As we could have different JVM targets we can specify it,
and as we know for sure that we want to target <strong><em>Android</em></strong>, we will name it in the target declaration <strong>android</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_source_sets_and_dependencies"><a class="anchor" href="#_source_sets_and_dependencies"></a>Source sets and dependencies</h3>
<div class="paragraph">
<p>In this section we will define all the dependencies needed for our Kotlin multi-platform common code.</p>
</div>
<div class="paragraph">
<p>There are three main dependencies that we will need to develop and use the Kotlin multi-platform library:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Ktor client</strong></p>
<div class="paragraph">
<p>Like for our backend API, we will use <strong>Ktor</strong> to empower our HTTP calls on the client side.
We will have to use multiple implementations to be able to make some HTTP calls, as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an HTTP engine (<em>OkHttp</em> for <strong><em>Android</em></strong> / <em>NSURLSession</em> for <strong><em>iOS</em></strong> / <em>Fetch</em> for <strong><em>JavaScript</em></strong>)</p>
</li>
<li>
<p>a JSON implementation to be able to serialize and de-serialize the requests/responses payloads.</p>
</li>
<li>
<p>a serialization interface to render JSON into domain objects (using <strong>Kotlinx.Serialization</strong>)</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Kotlinx.Serialization</strong></p>
<div class="paragraph">
<p>To serialize and de-serialize our HTTP calls content, we will use a Kotlin multi-platform library, develop by JetBrains, <strong>Kotlinx.Serialization</strong>.</p>
</div>
</li>
<li>
<p><strong>Kotlinx.Coroutines</strong></p>
<div class="paragraph">
<p>As <strong>Ktor</strong> is an asynchronous framework, and it is based on coroutines, we need to use coroutines context to wrap our HTTP calls.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid code redundancy, we will prepare some shortcuts to declare the dependencies:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts - source sets code block</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
// ...
        sourceSets {
        // Versions
        val ktorVersion = "1.2.6"
        val coroutinesVersion = "1.3.2"
        val serializationVersion = "0.14.0"
        // Shortcuts
        fun kotlinx(module: String, version: String)
            = "org.jetbrains.kotlinx:kotlinx-$module:$version" <i class="conum" data-value="1"></i><b>(1)</b>
        fun coroutines(module: String = "")
            = kotlinx("coroutines-core$module", coroutinesVersion) <i class="conum" data-value="2"></i><b>(2)</b>
        fun serialization(module: String = "")
            = kotlinx("serialization-runtime$module", serializationVersion) <i class="conum" data-value="3"></i><b>(3)</b>
        fun ktorClient(module: String, version: String
            = ktorVersion) = "io.ktor:ktor-client-$module:$version" <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Builds the dependency name for any <strong>kotlinx</strong> module with its version</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Builds the dependency name for any <strong>coroutines-core</strong> module</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Builds the dependency name for any <strong>serialization-runtime</strong> module</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Builds the dependency name for any <strong>ktor-client</strong> module</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_common"><a class="anchor" href="#_common"></a><strong><em>Common</em></strong></h4>
<div class="paragraph">
<p>In this part, we will declare the transverse dependencies for all of our targeted platforms.</p>
</div>
<div class="paragraph">
<p>Add the following lines to the <code>build.gradle.kts</code> file, in the <code>kotlin &gt; sourceSets</code> block:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
// ...
        sourceSets {
        // ...
        val commonMain by getting {
            dependencies {
                // Kotlin
                implementation(kotlin("stdlib-common")) <i class="conum" data-value="1"></i><b>(1)</b>
                // Kotlinx
                implementation(coroutines("-common")) <i class="conum" data-value="2"></i><b>(2)</b>
                implementation(serialization("-common")) <i class="conum" data-value="3"></i><b>(3)</b>
                // Ktor client
                implementation(ktorClient("core")) <i class="conum" data-value="4"></i><b>(4)</b>
                implementation(ktorClient("json")) <i class="conum" data-value="5"></i><b>(5)</b>
                implementation(ktorClient("serialization")) <i class="conum" data-value="6"></i><b>(6)</b>
            }
        }
        // ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Kotlin Standard Library for Kotlin multi-platform common projects.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Kotlinx.Coroutines API for Kotlin multi-platform common library.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Kotlinx.Serialization API for Kotlin multi-platform common library.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Common API to use Ktor client on Kotlin multi-platform projects.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Common API to use Json Serializers on Kotlin multi-platform projects.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Common API to use Kotlinx.Serialization with Ktor client on Kotlin multi-platform projects.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_targeted_platforms"><a class="anchor" href="#_targeted_platforms"></a>Targeted platforms</h4>
<div class="paragraph">
<p>Now that we have defined our common dependencies, we need to define the dependencies for each targeted platforms of our Kotlin multi-platform library.</p>
</div>
<div class="paragraph">
<p>In fact, in our case, it is very simple as each platforms need to import the corresponding implementation of each API dependencies defined in the common module.</p>
</div>
<div class="paragraph">
<p>Add the following lines to the <code>build.gradle.kts</code> file, in the <code>kotlin &gt; sourceSets</code> block:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
// ...
        sourceSets {
        // ...
         val androidMain by getting {
            dependencies {
                // Kotlin
                implementation(kotlin("stdlib")) <i class="conum" data-value="1"></i><b>(1)</b>
                // Kotlinx
                implementation(coroutines()) <i class="conum" data-value="2"></i><b>(2)</b>
                implementation(serialization()) <i class="conum" data-value="3"></i><b>(3)</b>
                // Ktor client
                implementation(ktorClient("core-jvm")) <i class="conum" data-value="4"></i><b>(4)</b>
                implementation(ktorClient("json-jvm")) <i class="conum" data-value="5"></i><b>(5)</b>
                implementation(ktorClient("serialization-jvm")) <i class="conum" data-value="6"></i><b>(6)</b>
                implementation(ktorClient("okhttp")) <i class="conum" data-value="7"></i><b>(7)</b>
            }
        }

         val iosMain by getting {
            dependencies {
                // Kotlinx
                implementation(coroutines("-native")) <i class="conum" data-value="2"></i><b>(2)</b>
                implementation(serialization("-native")) <i class="conum" data-value="3"></i><b>(3)</b>
                // Ktor client
                implementation(ktorClient("core-native")) <i class="conum" data-value="4"></i><b>(4)</b>
                implementation(ktorClient("json-native")) <i class="conum" data-value="5"></i><b>(5)</b>
                implementation(ktorClient("serialization-native")) <i class="conum" data-value="6"></i><b>(6)</b>
                implementation(ktorClient("ios")) <i class="conum" data-value="7"></i><b>(7)</b>
            }
        }

         val jsMain by getting {
            dependencies {
                // Kotlin
                implementation(kotlin("stdlib-js")) <i class="conum" data-value="1"></i><b>(1)</b>
                // Kotlinx
                implementation(coroutines("-js")) <i class="conum" data-value="2"></i><b>(2)</b>
                implementation(serialization("-js")) <i class="conum" data-value="3"></i><b>(3)</b>
                // Ktor client
                implementation(ktorClient("core-js")) <i class="conum" data-value="4"></i><b>(4)</b>
                implementation(ktorClient("json-js")) <i class="conum" data-value="5"></i><b>(5)</b>
                implementation(ktorClient("serialization-js")) <i class="conum" data-value="6"></i><b>(6)</b>
                implementation(ktorClient("js")) <i class="conum" data-value="7"></i><b>(7)</b>
            }
        }
        // ...
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Kotlin Standard Library for the target.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Kotlinx.Coroutines implementation for the target.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Kotlinx.Serialization implementation for the target.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Implementation of Ktor client for the target.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Implementation of Json Serializers for the target.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Implementation of Kotlinx.Serialization with Ktor client for the target.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specific HTTP client engine for the target, used by Ktor for making HTTP calls.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Remember:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the names of the source sets depends on the targets, thus</p>
<div class="ulist">
<ul>
<li>
<p><code>android</code> target will have the source sets <code>androidMain</code> and <code>andrdoidTest</code>.</p>
</li>
<li>
<p><code>ios</code> target will have the source sets <code>iosMain</code> and <code>iosTest</code>.</p>
</li>
<li>
<p><code>js</code> target will have the source sets <code>jsMain</code> and <code>jsTest</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>we do not need to declare the Kotlin Standard Library for native project, as it is included by the native compiler.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_the_ios_special_case"><a class="anchor" href="#_the_ios_special_case"></a>The iOS special case</h4>
<div class="paragraph">
<p>Building libraries for <strong><em>iOS</em></strong> is also a special case in our build script.
In fact, to be able to use our common library in <strong><em>Xcode</em></strong>, we need to build a <strong><em>framework</em></strong> file.</p>
</div>
<div class="paragraph">
<p>To obtain this <strong><em>framework</em></strong> file, add the following block at the end of your Gradle build file:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">//...
val packForXcode by tasks.creating(Sync::class) { <i class="conum" data-value="1"></i><b>(1)</b>
    val mode = System.getenv("CONFIGURATION") ?: "DEBUG" <i class="conum" data-value="2"></i><b>(2)</b>
    val framework = kotlin.targets
        .getByName&lt;org.jetbrains.kotlin.gradle.plugin.mpp.KotlinNativeTarget&gt;("ios")
        .binaries.getFramework(mode)
    inputs.property("mode", mode)

    dependsOn(framework.linkTask) <i class="conum" data-value="3"></i><b>(3)</b>

    val targetDir = File(buildDir, "xcode-frameworks")
    from({ framework.outputDirectory }) <i class="conum" data-value="4"></i><b>(4)</b>
    into(targetDir) <i class="conum" data-value="5"></i><b>(5)</b>
}

tasks.getByName("build").dependsOn(packForXcode) <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a new task to make the framework available for <strong><em>Xcode</em></strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Selects the right configuration depending on the environment variables set by Xcode build</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The new task depends on the fact that the framework has been built</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Moves the built framework from the build directory&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>&#8230;&#8203;to a new location (could/should be a remote path)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Sets the <code>packForXcode</code> task as part of the <code>build</code> task</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s keep the configuration aside and start coding :)</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_defining_the_domain_objects"><a class="anchor" href="#_defining_the_domain_objects"></a>Defining the domain objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First thing, we will create the domain objects needed to manage an <strong>Address Book</strong>.
Here is a class diagram of our data model:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/8-4.png" alt="class diagram" width="350"></span></p>
</div>
<div class="paragraph">
<p>Those data classes will be used to send/receive data to/from the backend API.
To be able to do so, we should defined them as serializable, using <strong>Kotlinx.Serialization</strong>.</p>
</div>
<div class="paragraph">
<p>In <code>commonMain/kotlin</code>, create the package <code>com.mybusiness.model</code> and the Kotlin source file <code>Contact.kt</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/8-5.png" alt="source directory structure" width="300"></span></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/8-6.png" alt="new directory"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>At the moment, if you want to create a package, you need to manually create the directory structure.</p>
</div></div></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then add the following data classes with the right import.</p>
</div>
<div class="listingblock">
<div class="title">Contact.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">import kotlinx.serialization.Serializable

@Serializable <i class="conum" data-value="1"></i><b>(1)</b>
data class Contact(
    val id: String,
    val name: Name,
    val addresses: List&lt;Address&gt; = mutableListOf(),
    val phones: List&lt;Phone&gt; = mutableListOf()
) {
    val fullName: String
        get() = "${name.lastName} ${name.firstName}"
}

@Serializable <i class="conum" data-value="1"></i><b>(1)</b>
data class Name(
    val firstName: String,
    val lastName: String
)

@Serializable <i class="conum" data-value="1"></i><b>(1)</b>
data class Address(
    val type: Type,
    val street: String,
    val postalCode: String,
    val city: String,
    val country: String
) {
    enum class Type(val displayedName: String) { HOME("HOME"), WORK("WORK"), OTHER("OTHER") }
}

@Serializable <i class="conum" data-value="1"></i><b>(1)</b>
data class Phone(
    val type: Type,
    val number: String
) {
    enum class Type(val displayedName: String) { HOME("HOME"), WORK("WORK"), MOBILE("MOBILE"), OTHER("OTHER") }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Makes the data classes serializable</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
the collections must be initialized, otherwise you could get some serialization exceptions.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reaching_the_backend_api"><a class="anchor" href="#_reaching_the_backend_api"></a>Reaching the backend API</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this section you will learn how to use the <strong>Ktor client</strong> API and how to serialize and de-serialize data with <strong>Kotlinx.Serialization</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that our data model is ready, we can implement the interface between the client and the backend API to retrieve data.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by creating a new package <code>api</code> and a Kotlin source file <code>ContactApi</code>, still in <code>commonMain/kotlin</code>:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/8-7.png" alt="source directory structure" width="300"></span></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/8-8.png" alt="new directory"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>To create a package aside of an existing one, you need to create it with its full path</p>
</div></div></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_creating_the_http_client"><a class="anchor" href="#_creating_the_http_client"></a>Creating the HTTP client</h3>
<div class="paragraph">
<p>First, to reach our API we have to declare an HTTP client:</p>
</div>
<div class="listingblock">
<div class="title">ContactApi.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">const val LOCALHOST = "127.0.0.1" <i class="conum" data-value="1"></i><b>(1)</b>
expect fun apiBaseUrl(): String <i class="conum" data-value="2"></i><b>(2)</b>

class ContactApi {
    private val client = HttpClient { <i class="conum" data-value="3"></i><b>(3)</b>
        install(JsonFeature) { <i class="conum" data-value="4"></i><b>(4)</b>
            serializer = KotlinxSerializer() <i class="conum" data-value="5"></i><b>(5)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declares a constant for the API host IP (localhost, as our backend API is running on our local machine)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An <code>expect</code> function will help define specific host IP (e.g. Android Simulator reach the local machine through <code>10.0.2.2</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creates the <strong>Ktor</strong> HTTP client.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Defines that the HTTP client will work with JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Register <strong>Kotlinx.Serialization</strong> to serialize and de-serialize JSON</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Every import in <code>ContactApi.kt</code> should come from <code>io.ktor.client</code> or <code>kotlinx.serialization`</code>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_apibaseurl_actual_implementation"><a class="anchor" href="#_apibaseurl_actual_implementation"></a><code>apiBaseUrl()</code> actual implementation</h4>
<div class="paragraph">
<p>We have defined an <code>expect</code> function in our code,
thus we must define an <code>actual</code> behaviors foreach targeted platforms to be able to compile our project.</p>
</div>
<div class="paragraph">
<p>For each targets, create a kotlin source file named <code>[ContactApi][platform].kt</code>, and add the right implementation for <code>apiBaseUrl()</code>.</p>
</div>
<div class="listingblock">
<div class="title">androidMain &gt; kotlin &gt; com.mybusiness.api/ContactApiAndroid.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">actual fun apiBaseUrl(): String = "10.0.2.2" <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>On an <strong><em>Android</em></strong> emulator <code>127.0.0.1</code> refers to the device itself.
To access your actual machine you need to use <code>10.0.2.2</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">iosMain &gt; kotlin &gt; com.mybusiness.api/ContactApiIos.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">actual fun apiBaseUrl() = LOCALHOST <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No special case here, your machine can be reached on <code>127.0.0.1</code></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">jsMain &gt; kotlin &gt; com.mybusiness.api/ContactApiJs.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">actual fun apiBaseUrl() = LOCALHOST <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No special case here, your machine can be reached on <code>127.0.0.1</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_apis_interfaces"><a class="anchor" href="#_creating_the_apis_interfaces"></a>Creating the APIs interfaces</h3>
<div class="paragraph">
<p>Before writing our interfaces to reach each endpoints of the backend API,
we will declare an <em>extension function</em> to wrap the API url definition.</p>
</div>
<div class="listingblock">
<div class="title">ContactApi.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">class ContactApi {
  //...
  private fun HttpRequestBuilder.apiUrl(path: String = "/") {
        url {
            host = apiBaseUrl() <i class="conum" data-value="1"></i><b>(1)</b>
            port = 8042 <i class="conum" data-value="2"></i><b>(2)</b>
            protocol = URLProtocol.HTTP
            encodedPath = "/api/contacts$path" <i class="conum" data-value="3"></i><b>(3)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Calling the <code>expect</code> function to get the right IP address to reach the backend API</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Port of our backend API</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Dynamic endpoint path, starting from "/api/contacts"</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_get_retrieve_the_contacts_from_the_backend_api"><a class="anchor" href="#_get_retrieve_the_contacts_from_the_backend_api"></a>GET - Retrieve the contacts from the backend API</h4>
<div class="paragraph">
<p>If you remember the previous section, we have ran a <strong>Ktor</strong> server. This server defines 4 endpoints:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>GET</em> <code>/api/contacts</code>: Retrieves a list of all the contacts</p>
</li>
<li>
<p><em>GET</em> <code>/api/contacts/{id}</code>: Retrieves a contact, identified by its <code>id</code></p>
</li>
<li>
<p><em>PUT</em> <code>/api/contacts</code>: Creates a new contact</p>
</li>
<li>
<p><em>POST</em> <code>/api/contacts/{id}</code>: Updates a contact, identified by its <code>id</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, we will provide interfaces for each one of those 4 endpoints, thus we will see how to send/receive data classes through an HTTP client.</p>
</div>
<div class="sect4">
<h5 id="_get_a_list_of_contacts"><a class="anchor" href="#_get_a_list_of_contacts"></a>Get a list of contacts</h5>
<div class="paragraph">
<p>Let&#8217;s start with the simplest case, retrieving a list of <code>Contact</code>. Create a <code>getAllContacts</code> function that returns a <code>List&lt;Contact&gt;</code>.
As the <strong>Ktor</strong> <code>HttpClient</code> works asynchronously with Kotlin coroutines, we need to define our function as <code>suspend</code>able.</p>
</div>
<div class="listingblock">
<div class="title">ContactApi.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">class ContactApi {
    //...
    suspend fun getAllContacts(): List&lt;Contact&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
        return Json.nonstrict.parse( <i class="conum" data-value="2"></i><b>(2)</b>
            Contact.serializer().list, <i class="conum" data-value="3"></i><b>(3)</b>
            client.get { <i class="conum" data-value="4"></i><b>(4)</b>
                apiUrl() <i class="conum" data-value="5"></i><b>(5)</b>
            }
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a <code>suspend</code> function that returns a <code>List&lt;Contact&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the <code>Json.nonstrict.parse</code> function from <strong>Kotlinx.Serialization</strong> to transfrom Json to <code>Contact</code> data class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register the serializer generated on <code>Contact</code> by the <code>kotlinx.serialization</code> plugin.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls the backend API&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>&#8230;&#8203;on the path <code>/api/contacts/</code></td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_get_a_specific_contact_by_its_id"><a class="anchor" href="#_get_a_specific_contact_by_its_id"></a>Get a specific contact by its <code>id</code></h5>
<div class="paragraph">
<p>Getting the list of all the contacts available on the backend just gives us the <code>id</code>, <code>firstname</code> and <code>lastname</code> of the contacts.
So, we should be able to get the detailed information for a contact giving its <code>id</code>.</p>
</div>
<div class="listingblock">
<div class="title">ContactApi.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">class ContactApi {
  //...
  suspend fun getContactById(contactId: String): Contact { <i class="conum" data-value="1"></i><b>(1)</b>
        return Json.nonstrict.parse( <i class="conum" data-value="2"></i><b>(2)</b>
            Contact.serializer(), <i class="conum" data-value="3"></i><b>(3)</b>
            client.get { <i class="conum" data-value="4"></i><b>(4)</b>
                apiUrl("/$contactId") <i class="conum" data-value="5"></i><b>(5)</b>
            }
        )
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a <code>suspend</code> function that wait for a <code>String</code> as parameter and returns a <code>Contact</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the <code>Json.nonstrict.parse</code> function from <strong>Kotlinx.Serialization</strong> to transfrom Json to <code>Contact</code> data class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register the serializer generated on <code>Contact</code> by the <code>kotlinx.serialization</code> plugin.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls the backend API&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>&#8230;&#8203;on the path <code>/api/contacts/{id}</code>, by passing the <code>contactId</code> received by the current function.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_put_create_a_contact_on_the_backend_api"><a class="anchor" href="#_put_create_a_contact_on_the_backend_api"></a>PUT - Create a contact on the backend API</h4>
<div class="paragraph">
<p>Now that we can retrieve data from the backend API, we should be able to create some contacts.
The backend API as an endpoint for that. We have to call the path <code>/api/contacts/</code> on the HTTP verb <em>PUT</em>,
with a body containing a <code>Contact</code> transformed into JSON.</p>
</div>
<div class="paragraph">
<p>Here is how to do it:</p>
</div>
<div class="listingblock">
<div class="title">ContactApi.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">class ContactApi {
    //...
    suspend fun putContact(contact: Contact): String { <i class="conum" data-value="1"></i><b>(1)</b>
        return Json.nonstrict.parse( <i class="conum" data-value="2"></i><b>(2)</b>
            (StringSerializer to StringSerializer).map, <i class="conum" data-value="3"></i><b>(3)</b>
            client.put { <i class="conum" data-value="4"></i><b>(4)</b>
                apiUrl() <i class="conum" data-value="5"></i><b>(5)</b>
                method = HttpMethod.Put <i class="conum" data-value="6"></i><b>(6)</b>
                body = TextContent(Json.stringify(Contact.serializer(), contact), <i class="conum" data-value="7"></i><b>(7)</b>
                    contentType = ContentType.Application.Json)
            }
        ).values.first()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a <code>suspend</code> function that wait for a <code>Contact</code> as parameter and returns a <code>String</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Uses the <code>Json.nonstrict.parse</code> function from <strong>Kotlinx.Serialization</strong> to transfrom Json to a <code>Map&lt;String, String&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register an existing serializer from <strong>Kotlinx.Serialization</strong> to get a <code>Map&lt;String, String&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Calls the backend API&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>&#8230;&#8203; on the path <code>/api/contacts/</code>&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>&#8230;&#8203; with the HTTP verb <em>PUT</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Sets the <code>contact</code> in the body of the HTTP Request, using the serializer generated on <code>Contact</code> by the <code>kotlinx.serialization</code> plugin.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_post_update_a_contact_on_the_backend_api"><a class="anchor" href="#_post_update_a_contact_on_the_backend_api"></a>POST - Update a contact on the backend API</h4>
<div class="paragraph">
<p>Finally, we have to be able to update an existing contact on the backend. Of course, their is an endpoint for that too.
We can update a contact by calling the bakend API on <code>/api/contacts/{id}</code>,
where <code>id</code> is a dynamic parameter that depends on the contact that we want to update.
Plus, we must pass the new data of the <code>Contact</code> to update, in a JSON shape.</p>
</div>
<div class="paragraph">
<p>Here is how to do it:</p>
</div>
<div class="listingblock">
<div class="title">ContactApi.kt</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">class ContactApi {
    //...
    suspend fun postContact(contact: Contact): Boolean { <i class="conum" data-value="1"></i><b>(1)</b>
        val response = client.call { <i class="conum" data-value="2"></i><b>(2)</b>
            apiUrl("/${contact.id}") <i class="conum" data-value="3"></i><b>(3)</b>
            method = HttpMethod.Post <i class="conum" data-value="4"></i><b>(4)</b>
            body = TextContent(Json.stringify(Contact.serializer(), contact), <i class="conum" data-value="5"></i><b>(5)</b>
                contentType = ContentType.Application.Json)
        }.response <i class="conum" data-value="6"></i><b>(6)</b>

        return response.status == HttpStatusCode.OK
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defines a <code>suspend</code> function that wait for a <code>Contact</code> as parameter and returns a <code>String</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declares a HTTP client call</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sets the URL for the client call to <code>/api/contacts/{id}</code>, by passing the <code>Contact::id</code>, from the <code>Contact</code> received by the current function.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sets the HTTP verb to be used as <em>POST</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Sets the <code>contact</code> in the body of the HTTP Request, using the serializer generated on <code>Contact</code> by the <code>kotlinx.serialization</code> plugin.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Trigger the HTTP request and wait for the response.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<link rel="stylesheet" href="highlightjs/styles/idea.min.css">
<script src="highlightjs/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>