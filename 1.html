<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Create a project</title>
<link rel="stylesheet" href="./golo.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Create a project</h1>
<div class="details">
<span id="revnumber">version 1.0</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_the_creation_wizard">The creation wizard</a></li>
<li><a href="#_targets_compilers">Targets &amp; compilers</a></li>
<li><a href="#_gradle_configuration">Gradle configuration</a>
<ul class="sectlevel2">
<li><a href="#_target_configuration">Target Configuration</a></li>
<li><a href="#_understanding_source_sets">Understanding source sets</a></li>
<li><a href="#_source_sets_configuration">Source sets configuration</a></li>
</ul>
</li>
<li><a href="#_source_sets_directories">Source sets directories</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The first thing to do is to create a new Kotlin/Multiplatform project.</p>
</div>
<div class="paragraph">
<p>Easy, you think: there&#8217;s a handy <code>Kotlin | Mobile Android/iOS | Gradle</code> template in the IDEA&#8217;s new project wizard.<br>
Well, we&#8217;re not going to use it.</p>
</div>
<div class="paragraph">
<p>Take a deep breath, stay with us.<br>
This templates&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203;gives you everything on a golden platter ; you need to learn how it is done.</p>
</li>
<li>
<p>&#8230;&#8203;creates a project where the Android app and the multi-platform code is all in one place.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_creation_wizard"><a class="anchor" href="#_the_creation_wizard"></a>The creation wizard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are going to create a new Gradle project.<br>
While we&#8217;re at it, we&#8217;ll be using the Gradle Kotlin DSL (if you haven&#8217;t used it already, now is your chance!).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Gradle Kotlin DSL allows you to bring type safety as well as IDE completion &amp; API exploration into your build script.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 65%;">
<col style="width: 35%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/1-0.png" alt="New project type wizard"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>In IntelliJ&#8217;s new project wizard, create a new project, and select <code>Gradle</code> &gt; <code>Kotlin/Multiplatform</code>.<br>
Don&#8217;t forget to check the <code>Kotlin DSL build script</code> checkbox.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/1-1.png" alt="New project configuration wizard"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Then, give your project a group ID, and name the artifact <code>business-library</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Finally, select where the code rests, click finish, and enjoy your newly created multi-platform project :)</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To avoid any misconfiguration issue you should change the <em>Gradle Wrapper&#8217;s</em> properties right now.</p>
</div>
<div class="paragraph">
<p>Go the the newly created file <code>gradle-wrapper.properties</code> under <code>/business-library/gradle/wrapper/</code>
and change the property <code>distributionUrl</code> with the value <code>https\://services.gradle.org/distributions/gradle-5.6.1-bin.zip</code></p>
</div>
<div class="listingblock">
<div class="title">gradle-wrapper.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs">distributionBase=GRADLE_USER_HOME
distributionPath=wrapper/dists
distributionUrl=https\://services.gradle.org/distributions/gradle-5.6.1-bin.zip
zipStoreBase=GRADLE_USER_HOME
zipStorePath=wrapper/dists</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Gradle wrapper should upgrade itself within the next Gradle action.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_targets_compilers"><a class="anchor" href="#_targets_compilers"></a>Targets &amp; compilers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kotlin infrastructure provides 3 compilers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Kotlin/JVM</strong> compiler, that compiles to JVM bytecode, which can be used on a JVM or on a JVM-like systems such as Android.</p>
</li>
<li>
<p>The <strong>Kotlin/JS</strong> compiler, that compiles to machine JavaScript (not human-readable), which can be used in a browser or on JS runtimes such as NodeJS.</p>
</li>
<li>
<p>The <strong>Kotlin/Native</strong> compiler, that compiles to specific machine binary code, which can be run on this specific machine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each compiler can support one to multiple targets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Kotlin/JVM</strong> compiler supports only one target: the <code>JVM</code></p>
</li>
<li>
<p>The <strong>Kotlin/JS</strong> compiler supports only one target: <code>JavaScript</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Kotlin/Native</strong> compiler supports multiple targets: <code>linuxX64</code>, <code>macosX64</code>, <code>mingw64</code>, <code>iosX64</code>, <code>iosArm32</code>, <code>iosArm64</code>, and many others.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When using Kotlin/Multiplatform to compile for multiple targets, it helps to understand which compiler is compiling for which target, as each of them get their specific configuration.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_configuration"><a class="anchor" href="#_gradle_configuration"></a>Gradle configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s have a look at the generated <code>build.gradle.kts</code> file.</p>
</div>
<div class="paragraph">
<p>The first few lines are applying the Kotlin Gradle plugin:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">plugins {
    kotlin("multiplatform") version "1.3.50"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the simplest way to apply a Gradle plugin, provided that it is registered in the <a href="https://plugins.gradle.org/">Gradle plugin repository</a>.</p>
</div>
<div class="paragraph">
<p>The next few lines are easily understood as they are common to every Kotlin project:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">group = "com.mybusiness"
version = "1.0"

repositories {
    mavenCentral()
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_target_configuration"><a class="anchor" href="#_target_configuration"></a>Target Configuration</h3>
<div class="paragraph">
<p>Next, we see the <code>kotlin</code> block, in which the entire compilation configuration happens.</p>
</div>
<div class="paragraph">
<p>First we&#8217;ll replace the following lines&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
    //...
    /* Targets configuration omitted.
    *  To find out how to configure the targets, please follow the link:
    *  https://kotlinlang.org/docs/reference/building-mpp-with-gradle.html#setting-up-targets */
    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;with the list of targets we intend to support.<br></p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
    //...
    jvm()             // JVM &amp; Android

    js { browser() }  // Browser JS

    iosX64()          // iOS simulator
    //...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We will see later how to also target regular iPhones
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We also need to add our host native target, so we can test native code directly while coding.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
    //...
    val os = org.gradle.internal.os.OperatingSystem.current()
    val hostTarget = when {
        os.isLinux -&gt; linuxX64("linux")
        os.isMacOsX -&gt; macosX64("macos")
        os.isWindows -&gt; mingwX64("mingw")
        else -&gt; throw IllegalStateException("Your OS [$os] is not supported!")
    }
    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code adds the native target corresponding to your host OS, and configure its source set to use the same source directory (<code>src/hostMain/kotlin</code>) whatever the target.</p>
</div>
</div>
<div class="sect2">
<h3 id="_understanding_source_sets"><a class="anchor" href="#_understanding_source_sets"></a>Understanding source sets</h3>
<div class="paragraph">
<p>A source set is a directory containing sources and/or resources.</p>
</div>
<div class="paragraph">
<p>When compiling for multiple targets, in essence, each Kotlin compilers will read from different source sets.</p>
</div>
<div class="paragraph">
<p>In a Kotlin/Multiplatform, by default, there are <code>targets + 1</code> source sets :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One named "common" which contains code that is common to all targets.</p>
</li>
<li>
<p>One for each targets that bears the name of the target.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each source set is itself divided into "Main" where the regular code lives, and "Test"</p>
</div>
<div class="paragraph">
<p>These are the source sets we have defined for our project :</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are not using linux, then you have created instead either <code>macosMain</code> &amp; <code>macosTest</code>, or <code>mingwMain</code> &amp; <code>mingwTest</code>.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/source-sets-1.png" alt="source sets 1" width="320" height="629">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_sets_configuration"><a class="anchor" href="#_source_sets_configuration"></a>Source sets configuration</h3>
<div class="paragraph">
<p>What happens next is the configuration of each source set, and particularly their dependencies.</p>
</div>
<div class="paragraph">
<p>By default, the creation wizard has already configured our main common source set to depend on the common standard library, and our test common source set to depend on the common test utils.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s add the configuration of the source set we&#8217;ve created:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle.kts</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">kotlin {
    //...
    sourceSets {
        val commonMain by getting {
            dependencies {
                implementation(kotlin("stdlib-common"))
            }
        }
        val commonTest by getting {
            dependencies {
                implementation(kotlin("test-common"))
                implementation(kotlin("test-annotations-common"))
            }
        }

        val jvmMain by getting {
            dependencies {
                implementation(kotlin("stdlib"))
            }
        }
        val jvmTest by getting {
            dependencies {
                implementation(kotlin("test"))
                implementation(kotlin("test-junit"))
            }
        }

        val jsMain by getting {
            dependencies {
                implementation(kotlin("stdlib-js"))
            }
        }
        val jsTest by getting {
            dependencies {
                implementation(kotlin("test-js"))
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We have not configured the native target source sets because there&#8217;s no need right now.
      Both the standard library &amp; the test utils are included by the native compiler.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_source_sets_directories"><a class="anchor" href="#_source_sets_directories"></a>Source sets directories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before starting to code, we need the directories in which we are going to put that code ;)</p>
</div>
<div class="paragraph">
<p>Create the following directories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>src/commonMain/kotlin</code> &amp; <code>src/commonTest/kotlin</code></p>
</li>
<li>
<p><code>src/jvmMain/kotlin</code> &amp; <code>src/jvmTest/kotlin</code></p>
</li>
<li>
<p><code>src/jsMain/kotlin</code> &amp; <code>src/jsTest/kotlin</code></p>
</li>
<li>
<p><code>src/linuxMain/kotlin</code> &amp; <code>src/linuxTest/kotlin</code> (or whatever your host os is)</p>
</li>
<li>
<p><code>src/iosX64Main/kotlin</code> &amp; <code>src/iosX64Test/kotlin</code> (if you are targetting iOS)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your using IntelliJ IDEA 2019.3 EAP or superior, it will suggest you the right folder to create regarding of your build script.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/1-2.png" alt="new directory" width="300"></span></p>
</div>
<div class="paragraph">
<p>Select all and type RETURN</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/1-3.png" alt="source directory structure"></span></p>
</div>
<div class="paragraph">
<p>Are you ready to write some code?</p>
</div>
</div>
</div>
</div>
<link rel="stylesheet" href="highlightjs/styles/idea.min.css">
<script src="highlightjs/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>