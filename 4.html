<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Using your Kotlin multi-platform library on Android</title>
<link rel="stylesheet" href="./golo.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Using your Kotlin multi-platform library on Android</h1>
<div class="details">
<span id="revnumber">version 1.0</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_project_creation_wizard">Project Creation Wizard</a></li>
<li><a href="#_gradle_configuration">Gradle configuration</a></li>
<li><a href="#_using_your_kotlin_multi_platform_library">Using your Kotlin multi-platform library</a>
<ul class="sectlevel2">
<li><a href="#_the_generated_project">The generated project</a></li>
<li><a href="#_modifying_the_code">Modifying the code</a></li>
</ul>
</li>
<li><a href="#_running_the_application_in_an_android_simulator">Running the application in an Android Simulator</a>
<ul class="sectlevel2">
<li><a href="#_android_virtual_device_manager">Android Virtual Device Manager</a></li>
<li><a href="#_running_the_application">Running the application</a></li>
</ul>
</li>
<li><a href="#_whats_next">What&#8217;s next ?</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We will start by the simplest way to use a Kotlin multi-platform library.</p>
</div>
<div class="paragraph">
<p>The first target of Kotlin was the <strong>JVM</strong>, thus its the easiest integration, so we will be using our library on <strong><em>Android</em></strong>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_creation_wizard"><a class="anchor" href="#_project_creation_wizard"></a>Project Creation Wizard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By now you should have installed <a href="https://developer.android.com/studio">Android Studio</a>.</p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 65%;">
<col style="width: 35%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/4-1.png" alt="creation wizard" width="600"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Open it and create a new project</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/4-2.png" alt="project template" width="600"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Choose a project template: <strong>Empty Activity</strong>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/4-3.png" alt="project details" width="600"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Then, set the application&#8217;s details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>package name: <code>com.mybusiness.android</code></p>
</li>
<li>
<p>your project location</p>
</li>
<li>
<p>choose Kotlin as the language</p>
</li>
<li>
<p>set the minimum API level: <code>API 21: Android 5.0</code></p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Click the <strong>Finish</strong> button, you now have an empty <strong><em>Android</em></strong> application, with one screen, ready to display a <code>Hello World!</code>.</p>
</div>
<div class="paragraph">
<p>Before running our app we will change the configuration and the code to integrate our Kotlin multi-platform library.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gradle_configuration"><a class="anchor" href="#_gradle_configuration"></a>Gradle configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can see that there are two files named <code>build.gradle</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one for the project&#8217;s build configuration</p>
</li>
<li>
<p>one for the <strong><em>Android</em></strong> application&#8217;s build configuration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will focus on the second one: <code>build.gradle (Module: app)</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong><em>Android Studio</em></strong> generates a <code>build.gradle</code> files, in Groovy, not Kotlin.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The generated file <code>build.gradle</code> is made of three parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <strong>plugins</strong>, needed to build an Android application with Kotlin</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-android-extensions'</code></pre>
</div>
</div>
</li>
<li>
<p>The <strong>android configuration</strong>, under <code>android{ &#8230;&#8203; }</code></p>
<div class="paragraph">
<p>This is the Gradle configuration to build any <strong><em>Android</em></strong> application defining
which SDK to use to build the app,
which minimum API version the app should be compatible with, etc.</p>
</div>
</li>
<li>
<p>The <strong>dependencies</strong>, under <code>dependencies { &#8230;&#8203; }</code></p>
<div class="paragraph">
<p>This part contains the definition of all the libraries that we will use to develop our application.
This is where we will bound the application with our Kotlin multi-platform library.</p>
</div>
<div class="paragraph">
<p>Remember, in the previous step we have built and published our library on <strong><em>Maven Local</em></strong>,
thus we need to add it to the Gradle configuration.</p>
</div>
<div class="listingblock">
<div class="title">app &gt; build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">//...
repositories {
    mavenLocal()
}
//...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, add the following dependency to your <code>build.gradle</code>, into the <code>app</code> module</p>
</div>
<div class="listingblock">
<div class="title">app &gt; build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">//...
dependencies {
    // implementations
    //...
    implementation 'com.mybusiness:business-library-jvm:1.0.0'
    //...
    // testImplementation
    // androidTestImplementation
}</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">dependency group</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">dependency name</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">version</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>com.mybusiness</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>business-library-jvm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1.0.0</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>By default, your project view is set to <strong>Android</strong>, but you can change it to be on a <strong>Project</strong> view</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/4-4.png" alt="project view" width="360"></span></p>
</div>
<div class="paragraph">
<p>Then, you should see your Kotlin multi-platform library as an external dependency:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/4-5.png" alt="dependencies" width="640"></span></p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_your_kotlin_multi_platform_library"><a class="anchor" href="#_using_your_kotlin_multi_platform_library"></a>Using your Kotlin multi-platform library</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we are ready to use our library, we need to prepare our application&#8217;s <code>MainActivity</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>There are some build issues when using Kotlin multi-platform libraries in an <strong><em>Android</em></strong> project.</p>
</div>
<div class="paragraph">
<p>If you get this kind of errors while building your application</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&gt; More than one file was found with OS independent path ‘META-INF/business-library.kotlin_module’</pre>
</div>
</div>
<div class="paragraph">
<p>You will need to exclude <code>kotlin_module</code> files in your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="title">app &gt; build.gradle &gt; android</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">android {
    //...
    packagingOptions {
        exclude 'META-INF/*.kotlin_module'
    }
    //...
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_the_generated_project"><a class="anchor" href="#_the_generated_project"></a>The generated project</h3>
<div class="paragraph">
<p>The template used to generate our current project has created an <strong>Empty Activity</strong>, with two files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an <em>XML</em> file (<code>res/layout/activity_main.xml</code>), defining the view and the components that will be displayed on the screen</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">res/layout/activity_main.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity"&gt;

    &lt;TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:layout_constraintTop_toTopOf="parent" /&gt;

&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>a <em>Kotlin</em> file (<code>com.mybusiness.android.MainActivity.kt</code>), defining the code behind the scene,
where we write the actions that will be applied on the displayed screen</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">com.mybusiness.android.MainActivity</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_modifying_the_code"><a class="anchor" href="#_modifying_the_code"></a>Modifying the code</h3>
<div class="paragraph">
<p>What we want is to display in the <code>TextView</code> the message from <code>sayHelloKotlinConf()</code> in our Kotlin multi-platform library.</p>
</div>
<div class="paragraph">
<p>First, we need to change the <code>TextView</code> in the <em>XML</em> file</p>
</div>
<div class="listingblock">
<div class="title">res/layout/activity_main.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">&lt;TextView
    android:id="@+id/mainTextView" <i class="conum" data-value="1"></i><b>(1)</b>
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:textSize="40sp" <i class="conum" data-value="2"></i><b>(2)</b>
    android:textAlignment="center" <i class="conum" data-value="3"></i><b>(3)</b>
    app:layout_constraintBottom_toBottomOf="parent"
    app:layout_constraintLeft_toLeftOf="parent"
    app:layout_constraintRight_toRightOf="parent"
    app:layout_constraintTop_toTopOf="parent" /&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gives a unique ID to the <code>TextView</code> to be able to call it from our Kotlin code</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets the text to a bigger size</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Center the text on the screen</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, we need to change the Kotlin code to display our message in the <code>TextView</code></p>
</div>
<div class="listingblock">
<div class="title">com.mybusiness.android.MainActivity</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="kotlin" class="language-kotlin hljs">import com.mybusiness.sayHelloKotlinConf <i class="conum" data-value="1"></i><b>(1)</b>

class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        mainTextView.text = sayHelloKotlinConf() <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>import the Kotlin multi-platform library package (can be done automatically by <strong><em>Android Studio</em></strong>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the text of the <code>TextView</code> with the function <code>sayHelloKotlinConf()</code> from our Kotlin multi-platform library</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>TextView</code> can be called in the code behind because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we explicitly named it in the <em>XML</em> with <code>android:id="@+id/mainTextView"</code></p>
</li>
<li>
<p>we ,or auto import, added <code>import kotlinx.android.synthetic.main.activity_main.*</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_application_in_an_android_simulator"><a class="anchor" href="#_running_the_application_in_an_android_simulator"></a>Running the application in an Android Simulator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run and test your application locally you need to configure an <em>Android Virtual Device</em>.</p>
</div>
<div class="sect2">
<h3 id="_android_virtual_device_manager"><a class="anchor" href="#_android_virtual_device_manager"></a>Android Virtual Device Manager</h3>
<div class="paragraph">
<p>If you do not have any configured device like in the following screenshot</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/4-6.png" alt="device configuration" width="640"></span></p>
</div>
<div class="paragraph">
<p>Open the <strong>Android Virtual Device Manager</strong> in the <strong>No devices</strong> dropdown</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/4-7.png" alt="device configuration dropdown" width="240"></span></p>
</div>
<table class="tableblock frame-none grid-none stretch">
<colgroup>
<col style="width: 70%;">
<col style="width: 30%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/4-8.png" alt="device wizard"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Click on <strong>+ Create a Virtual Device&#8230;&#8203;</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/4-9.png" alt="select hardware"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Select a targeted hardware (here the <strong><em>Google Pixel 3</em></strong>)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/4-10.png" alt="select software"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Select the targeted Android version (here <strong><em>Android 10</em></strong>)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you do not have the SDK already, click on <strong>Download</strong>.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/res/4-11.png" alt="finalize device"></span></p></td>
<td class="tableblock halign-left valign-middle"><div class="content"><div class="paragraph">
<p>Click <strong>Finish</strong> and close the <strong>AVD Manager</strong></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_running_the_application"><a class="anchor" href="#_running_the_application"></a>Running the application</h3>
<div class="paragraph">
<p><span class="image"><img src="images/res/4-12.png" alt="run the app" width="480"></span>
Run the application by clicking on <span class="image"><img src="images/res/run-android.png" alt="run adnroid" width="16"></span></p>
</div>
<div class="paragraph">
<p>An Android simulator will open with the following screen:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/res/4-13.png" alt="final result" width="360"></span></p>
</div>
<div class="paragraph">
<p>Here we are ! We can see, displayed on the screen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the common message: <code>Hello KotlinConf, Kotlin/Multiplatform is awesome!</code></p>
</li>
<li>
<p>the <strong>JVM</strong> specific message: <code>We are running on JVM</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next"><a class="anchor" href="#_whats_next"></a>What&#8217;s next ?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the next step we will see how to do the same with <strong><em>Xcode</em></strong> for the <strong><em>iOS</em></strong> platform.</p>
</div>
</div>
</div>
</div>
<link rel="stylesheet" href="highlightjs/styles/idea.min.css">
<script src="highlightjs/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>